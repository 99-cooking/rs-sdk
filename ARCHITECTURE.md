# RS-SDK Architecture (99 Cooking's Notes)

## Overview

This is a fork of the [LostCity](https://github.com/LostCityRS/Server) RuneScape private server, enhanced with a BotSDK for automation.

## Components

### 1. Game Server (engine/)
The main game simulation running on Bun (Node.js alternative).

**Ports:**
- `8080` - Web server (serves game client, hiscores, etc.)
- `43594` - Game server TCP (RuneScape protocol)
- `43500` - Login server (authentication)
- `45099` - Friend server (friend lists)
- `43501` - Logger server

**Key Files:**
- `src/app.ts` - Main entry point
- `data/pack/` - Compiled game content (generated by build)
- `db.sqlite` - Player accounts, hiscores (needs persistence!)
- `data/players/` - Player save files (needs persistence!)

### 2. WebClient (webclient/)
Browser-based game client in TypeScript.

Two builds:
- **Standard client** - For playing normally
- **Bot client** - Has BotSDK embedded for automation

### 3. Gateway (gateway/)
WebSocket relay connecting browser clients to SDK scripts.

**Port:** `7780`

**How it works:**
1. Bot browser client connects to gateway
2. SDK script connects to gateway with same bot name
3. Gateway routes messages between them

### 4. SDK (sdk/)
TypeScript library for writing bot scripts.

**Key Classes:**
- `BotSDK` - Low-level WebSocket API
- `BotActions` - High-level actions (walk, interact, etc.)
- `ScriptRunner` - Zero-boilerplate script execution

## Data Flow

```
┌──────────────┐    ws://gateway:7780    ┌─────────────┐
│  SDK Script  │◄───────────────────────►│   Gateway   │
└──────────────┘                         └──────┬──────┘
                                                │
                                                │ ws://gateway:7780
                                                │
┌──────────────┐    ws://server:43594    ┌──────▼──────┐
│  Game Server │◄───────────────────────►│ Bot Client  │
└──────────────┘                         │  (Browser)  │
                                         └─────────────┘
```

## Persistence

**Volume mounted at:** `/opt/server/data`

Symlinks:
- `/opt/server/engine/db.sqlite` → `/opt/server/data/db.sqlite`
- `/opt/server/engine/data/players/` → `/opt/server/data/players/`

## Configuration

Key environment variables:
- `NODE_XPRATE=25` - XP multiplier (25x faster)
- `NODE_MEMBERS=true` - Members content enabled
- `EASY_STARTUP=true` - All servers in one process
- `DB_BACKEND=sqlite` - Using SQLite
- `LOGIN_SERVER=true` - Authentication enabled

## URLs

- **Play:** https://rs-server-production.up.railway.app/bot?bot=NAME&password=test
- **Hiscores:** https://rs-server-production.up.railway.app/hiscores
- **Gateway:** wss://rs-server-production.up.railway.app/gateway

## Running Bots

```sh
# Clone SDK
git clone https://github.com/99-cooking/rs-sdk.git
cd rs-sdk && bun install

# Create a bot (creates bots/mybot/ directory with bot.env)
bun scripts/create-bot.ts mybot

# Run a script
bun bots/mybot/script.ts
```

The SDK automatically opens a browser, connects to the gateway, and executes your script.
